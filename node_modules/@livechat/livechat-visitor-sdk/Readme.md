# Introduction

LiveChat Visitor JS SDK allows you to perform a chat via LiveChat as a visitor using JavaScript. 

You can use this to create your own chat widget.

## Is it for me?

If you need to customize the LiveChat widget, using LiveChat Visitor JS SDK is one of the options to do this.

Keep in mind, however, that interacting with this API requires **significant development skills**. 

* If you only want to modify the look and feel of the chat window, check if you can do this with [custom CSS](https://www.livechatinc.com/kb/customize-your-chat-window-with-css/).

* If you want to integrate the chat widget with your application, you can use the the existing [JS API](https://docs.livechatinc.com/js-api/).

However, if you  need a fully custom solution and you feel brave, dive into LiveChat Visitor JS SDK: we provide [methods](#methods) and [callbacks](#callbacks) for deep integration with the LiveChat environment.

## About LiveChat Visitor JS SDK

LiveChat Visitor JS SDK is promise-based; all asynchronous methods return a promise. To get a promise fulfillment result, subscribe your handler to the promise's `then` method. Check out [this article](https://developer.mozilla.org/pl/docs/Web/JavaScript/Reference/Global_Objects/Promise) to learn more about promises.

**Important!** Some methods and callbacks are not implemented yet. 

## Examples

- [A sample chat widget implementation](https://glitch.com/#!/project/livechat-sample-chat-widget)
- [A sample iOS React Native implementation](https://github.com/livechat/chat-window-react-native-example)

## Resources

- [LiveChat Visitor SDK tutorial - blog post](https://developers.livechatinc.com/blog/livechat-visitor-sdk/)
- [npm package](https://www.npmjs.com/package/@livechat/livechat-visitor-sdk)
# How to start

## Install Visitor JS SDK

You can use LiveChat Visitor JS API in two different ways:

#### Using npm

`npm install --save @livechat/livechat-visitor-sdk`

Now, you can import SDK in your code:

`import LivechatVisitorSDK from "@livechat/livechat-visitor-sdk";`

#### Using script tag - UMD module hosted on unpkg's CDN

`<script
src="https://unpkg.com/@livechat/livechat-visitor-sdk@0.28.4/dist/livechat-visitor-sdk.min.js"></script>`

If you just want to look around and play with the SDK, check out our
[sample chat widget implementation](https://glitch.com/#!/project/livechat-sample-chat-widget)

## Use SDK

Now run the init function with configuration, replacing `LICENSE_NUMBER` with
your LiveChat license number. The function will return the visitorSDK interface:

```js
const visitorSDK = LivechatVisitorSDK.init({
  license: LICENSE_NUMBER,
})
```

With `visitorSDK`, you can attach [callbacks](#callbacks) or execute
[methods](#methods).

```js
visitorSDK.on('new_message', newMessage => {
  console.log(newMessage)
})

visitorSDK
  .sendMessage({
    text: 'Hello',
    customId: 123423215,
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```
# Methods

## init

Initializes the chat window.

```js
import LivechatVisitorSDK from "@livechat/livechat-visitor-sdk";

const visitorSDK = LivechatVisitorSDK.init({
    license: 123,
    group: 0,
})
```

#### Parameters:

| param   | type   | description              |
| ------- | ------ | ------------------------ |
| license | number | LiveChat license number  |
| group   | number | Group number (default: 0) |

## sendMessage

Sends a message.

```js
visitorSDK.sendMessage({
    text: "Hello",
    customId: "123423215"
})
    .then((response) => {
        console.log(response)
    })
    .catch((error) => {
        console.log(error)
    })
```

#### Parameters:

| param    | type   | description          |
| -------- | ------ | -------------------- |
| text     | string | Visitor message text |
| customId | string | Message custom id    |

#### Errors:

| type             | reason                               |
| ---------------- | ------------------------------------ |
| connection       | "Request failed"                     |
| missing argument | "Missing text or customId parameter" |

## closeChat

Closes the chat.

```js
visitorSDK.closeChat()
    .then(() => {
        console.log("Chat is closed")
    })
    .catch((error) => {
        console.log(error)
    })
```

This method has no parameters.

#### Response:

| param   | type    | description               |
| ------- | ------- | ------------------------- |
| success | boolean | Request's response status |

#### Errors: 

| type               | reason                    |
| ------------------ | ------------------------- |
| "state"            | There is no chat to close |
| "connection"       | Request failed            |


## sendFile - not implemented yet

Enables [file sharing](https://www.livechatinc.com/features/chat-tools/#File-sharing) through the chat window.

```js
visitorSDK.sendFile({
    file: FileObject,
    customId: "123423215"
})
    .then((response) => {
        console.log(response.status)
    })
    .catch((error) => {
        console.log(error)
    })
```

#### Parameters:

| param      | type   | description    |
| ---------- | ------ | -------------- |
| file       | file   | File to upload |
| customId   | string | custom file id |


## rateChat

Enables [chat ratings](https://www.livechatinc.com/features/getting-feedback/#Chat-ratings).

```js
visitorSDK.rateChat({
    rate: "good",
    comment: "Agent helped me a lot!"
})
    .then((response) => {
        console.log(response)
    })
    .catch((error) => {
        console.log(error)
    })
```

#### Parameters:

| param   | type                      | description                  |
| ------- | ------------------------- | ---------------------------- |
| rate    | "good" \| "bad" \| "none" | Rate type                    |
| comment | string                    | Rate comment text (optional) |

#### Response:

| param   | type    | description               |
| ------- | ------- | ------------------------- |
| success | boolean | Request's response status |

#### Errors: 

| type               | reason                                                |
| ------------------ | ----------------------------------------------------- |
| "missing argument" | Missing rate parameter                                |
| "wrong argument"   | Rate argument should be equal "good", "bad" or "none" |
| "connection"       | Request failed                                        |
| "connection"       | Rate Comment request failed                           |

## markMessageAsSeen - not implemented yet

Marks a message as Seen.

Learn more about LiveChat delivery statuses [here](https://www.livechatinc.com/features/chat-tools/#Delivery-status).

```js
visitorSDK.markMessageAsSeen({
    messageId: "123123123",
})
```

#### Parameters:

| param     | type   | description                        |
| --------- | ------ | ---------------------------------- |
| messageId | string | Id of message to be marked as seen |



## setSneakPeek

Enables [sneak peeks](https://www.livechatinc.com/features/chat-tools/#Message-sneak-peak) to see what the visitor is typing in before they actually send the message.

```js
visitorSDK.setSneakPeek({
    text: "Hello, I woul",
})
```

#### Parameters:

| param   | type   | description                |
| ------- | ------ | -------------------------- |
| message | string | Current message input text |

**Note:** Sneak peek won't be sent every time you call a function. It will be throttled (i.e. sent not earlier than 300ms after the last sneak peek request).


## forwardChatTranscript

Sends [chat transcripts](https://www.livechatinc.com/features/chat-tools/#Chat-tools-other-features) to the specified email address when the chat is ended.

```js
visitorSDK.forwardChatTranscript({
    email: "test@livechatinc.com",
})
    .then((response) => {
        console.log(response)
    })
    .catch((error) => {
        console.log(error)
    })
```

#### Parameters:

| param | type   | description                                                                |
| ----- | ------ | -------------------------------------------------------------------------- |
| email | string | Email that will automatically receive a transcript when a chat is finished |

#### Response:

| param   | type    | description               |
| ------- | ------- | ------------------------- |
| success | boolean | Request's response status |

#### Errors: 

| type               | reason                                 |
| ------------------ | -------------------------------------- |
| "state"            | There is no chat to forward transcript |
| "missing argument" | Missing email parameter                |
| "connection"       | Request failed                         |

## sendPrechatForm - not implemented yet

Collects the pre-chat form information (it will be visible during the chat and in the archives).

```js
visitorSDK.sendPrechatForm(form)
```

## sendPostchatForm - not implemented yet

Collects the [post-chat form](https://www.livechatinc.com/features/getting-feedback/#Post-chat-surveys) information (it will be visible in the archives).

```js
visitorSDK.sendPostchatForm(form)
```


## getVisitorData

Collects the [visitor information](https://www.livechatinc.com/features/chat-tools/#Visitor-information).

```js

const visitorData = visitorSDK.getVisitorData()
    .then((visitorData) => {
        console.log(visitorData)
    })
```

#### Returned value: 

| param            | type   | description                                                               |
| ---------------- | ------ | ------------------------------------------------------------------------- |
| name             | string | Visitor's name                                                            |
| email            | string | Visitor's email address                                                   |
| pageUrl          | string | Visitor's currently visiting website URL                                  |
| pageTitle        | string | Visitor's currently visiting website title                                |
| customProperties | object | Visitor's additional data object (custom properties) |

## setVisitorData

Set the [visitor information](https://www.livechatinc.com/features/chat-tools/#Visitor-information).

```js
visitorSDK.setVisitorData({
    name: "Wynton Marsalis",
    email: "test@livechatinc.com",
    pageUrl: 'http://example.org/pricing',
    pageTitle: 'Pricing',
    customProperties: {
        login: 'wyntonmarsalis',
        customerId: '18260556127834'
    }
})
```

#### Parameters:

| param            | type   | description                                          |
| ---------------- | ------ | ---------------------------------------------------- |
| name             | string | Visitor's name                                       |
| email            | string | Visitor's email address                              |
| pageUrl          | string | Visitor's currently visiting website URL             |
| pageTitle        | string | Visitor's currently visiting website title           |
| customProperties | object | Visitor's additional data object (custom properties) |

#### Errors:

| type             | reason                                         |
| ---------------- | ---------------------------------------------- |
| missing argument | "Missing name, email, url or customProperties" |
| connection       | "Request failed"                               |

## getTicketForm

Get [ticket form](https://www.livechatinc.com/features/engaging-customers/#Ticket-form) fields configured in chat window settings section in agent app.

```js
visitorSDK.getTicketForm()
    .then((data) => {
        console.log('Ticket form data', data)
    })
    .catch((error) => {
        console.log('error')
    })

```

This method has no parameters.

#### Response:

| param  | type    | description                                                        |
| ------ | ------- | ------------------------------------------------------------------ |
| fields | formField[] | Array with form fields details - see field's description below |

#### formField object description

| param    | type                                    | description              |
| -------- | --------------------------------------- | ------------------------ |
| type     | "name" / "subject" / "email" / "header" | Type of the field        |
| required | boolean                                 | Is field required?       |
| label    | string                                  | Field's label            |
| value    | string                                  | Optional - field's value |

## sendTicketForm

Send [ticket form](https://www.livechatinc.com/features/engaging-customers/#Ticket-form) filled in by visitor. Ticket form should be rendered using fields fetched by getTicketForm method. 

```js
visitorSDK.sendTicketForm({
    name: 'John',
    email: 'john@example.org',
    subject: 'App support',
    message: 'I have a problem with your app'
})
    .then(() => {
        console.log('Ticket sent')
    })
    .catch((error) => {
        console.log('error')
    })

```

#### Parameters

| param   | type   | description             |
| ------- | ------ | ----------------------- |
| name    | string | Vistior's name          |
| email   | string | Visitor's email address |
| subject | string | Ticket subject          |
| message | string | Visitor's message       |

#### Response:

| param   | type    | description               |
| ------- | ------- | ------------------------- |
| success | boolean | Request's response status |

#### Errors:

| type             | reason            |
| ---------------- | ----------------- |
| connection       | "Request failed"  |
| missing argument | "Missing email"   |
| missing argument | "Missing message" |

## disconnect

Disconnect Visitor SDK. A visitor won't be tracked, and you won't be notified about agent's availability status. You will be automatically connected again after using sendMessage or setVisitorData methods. 

```js
visitorSDK.disconnect()
```

#### Errors:

| type    | reason                                        |
| ------- | --------------------------------------------- |
| state   | "You can't disconnect during the chat"        |

## destroy

Disconnect Visitor SDK and unsubscribe from all callbacks.

```js
visitorSDK.destroy()
```
# Callbacks

Callbacks let you bind a custom JavaScript function to an event. For example, your function can be executed every time agent's message has been received.

## visitor_data

Callback function executed when server returns visitor's data.

```js
visitorSDK.on('visitor_data', (visitorData) => {
    console.log(visitorData)
})
```
#### Payload:

| param | type    | description |
| ----- | ------- | ----------- |
| id    | string  | Visitor ID  |

## new_message

Callback function executed when a new message arrives.

```js
visitorSDK.on('new_message', (newMessage) => {
    console.log(newMessage)
})
```
#### Payload:

| param        | type    | description                                     |
| ------------ | ------- | ----------------------------------------------- |
| id           | string  | Message ID                                      |
| authorId     | string  | Message author ID                               |
| timestamp    | number  | Timestamp added by server                       |
| text         | string  | Message text                                    |
| chatId       | string  | Message chat ID                                 |
| customId     | string  | Message custom ID (for visitor's messages only) |

## visitor_banned - not implemented yet

Callback function executed when a [visitor is banned](https://www.livechatinc.com/features/chat-tools/#Chat-tools-other-features).

```js
visitorSDK.on('visitor_banned', (data) => {
    console.log(data)
})
```


## chat_started

Callback function executed when a chat is started.

```js
visitorSDK.on('chat_started', (chatData) => {
    console.log(chatData)
})
```
#### Payload:

| param  | type    | description |
| ------ | ------- | ----------- |
| chatId | string  | New chat ID |

## chat_ended

Callback function executed when a chat is ended. This callback is called without any additional data.

```js
visitorSDK.on('chat_ended', (chatData) => {
    console.log('Chat is closed');
})
```


## status_changed

Callback function executed when the chat status is changed.

```js
visitorSDK.on('status_changed', (statusData) => {
    console.log(statusData)
})
```

#### Payload:

| param  | type                  | description                      |
| ------ | --------------------- | -------------------------------- |
| status | "online" \| "offline" | Current chat availability status |

## visitor_queued

Callback function executed when a visitor is queued.

```js
visitorSDK.on('visitor_queued', (queueData) => {
    console.log(queueData)
})
```

#### Payload:

| param         | type   | description                       |
| ------------- | ------ | --------------------------------- |
| numberInQueue | number | Visitor's order number in queue   |
| waitingTime   | number | Estimated waiting time in seconds |

## connection_status_changed

Callback function executed when the connection status changes.

```js
visitorSDK.on('connection_status_changed', (statusData) => {
    console.log(statusData)
})
```

#### Payload:

| param  | type                          | description               |
| ------ | ----------------------------- | ------------------------- |
| status | "connected" \| "disconnected" | Current connection status |

## new_file

Callback function executed when a [file is shared](https://www.livechatinc.com/features/chat-tools/#File-sharing).

```js
visitorSDK.on('new_file', (newFile) => {
    console.log(newFile)
})
```

#### Payload:

| param       | type   | description                           |
| ----------- | ------ | ------------------------------------- |
| id          | string | File ID                               |
| authorId    | string | File author ID                        |
| timestamp   | number | Timestamp added by server             |
| url         | string | File url                              |
| contentType | string | File content type (i.e. 'text/plain') |
| size        | number | File size                             |

## agent_changed

Callback function executed when an agent takes over the chat.

```js
visitorSDK.on('agent_changed', (newAgent) => {
    console.log(newAgent)
})
```

#### Payload:

| param     | type    | description                                     |
| --------- | ------- | ----------------------------------------------- |
| name      | string  | Agent's name                                    |
| id        | string  | Agent's ID                                      |
| avatarUrl | string  | Agent's avatar - path to the image on Amazon s3 |
| jobTitle  | string  | Agent's job title                               |

## typing_indicator

Callback function executed when the typing indicator appears.

```js
visitorSDK.on('typing_indicator', (typingData) => {
    console.log(typingData)
})
```

#### Payload:

| param    | type    | description                       |
| -------- | ------- | --------------------------------- |
| authorId | string  | Author ID of the writer           |
| isTyping | boolean | Author is typing / stopped typing |

## message_seen - not implemented yet

Callback function executed when a message is marked as seen.

Learn more about LiveChat delivery statuses [here](https://www.livechatinc.com/features/chat-tools/#Delivery-status).

```js
visitorSDK.on('message_seen', (messageData) => {
    console.log(messageData)
})
```
# Changelog

Subscribe to [LiveChat Developers Newsletter](http://eepurl.com/V75-9) to be
notified about changes in Visitor SDK.

#### [v0.28.4] - 27.11.2017

##### Fixed

* Fixed docs

#### [v0.28.3] - 22.11.2017

##### Fixed

* Fixed npm build Safari support

#### [v0.28.2] - 22.11.2017

##### Fixed

* Fixed iOS Safari support

##### Changed

* New reject type for setVisitorData method: "connection"

#### [v0.28.1] - 30.10.2017

##### Fixed

* Fixed npm build

#### [v0.28.0] - 30.10.2017

##### Added

* Added destroy method

##### Changed

* Added customId parameter to new_message callback's data

#### [v0.27.1] - 30.10.2017

##### Fixed

* Adjust docs according to
  [Docs Changelog Guidelines](https://github.com/livechat/docs-templates/blob/master/docs-changelog-guidelines.md)

#### [v0.27.0] - 16.10.2017

##### Added

* Added getVisitorData method

##### Changed

* setVisitorData method: Added possibility to set customProperties

#### [v0.0.26] - 13.10.2017

##### Added

* Added getTicketForm method
* Added sendTicketForm method

##### Fixed

* Fixed error handling

##### Changed

* setVistiorData method renamed to setVisitorData

#### [v0.0.25] - 03.10.2017

##### Added

* Added disconnect method

#### [v0.0.24] - 12.09.2017

##### Added

* Added iOS React Native sample app to Examples

#### [v0.0.23] - 11.09.2017

##### Added

* Added visitor_data callback

#### [v0.0.22] - 07.09.2017

##### Added

* Support for non-browser environments

#### [v0.0.21] - 06.09.2017

##### Added

* Added closeChat method

#### [v0.0.20] - 05.09.2017

##### Fixed

* Fix npm package - add all dependencies

#### [v0.0.19] - 31.08.2017

##### Added

* Added forwardChatTranscript method

#### [v0.0.18] - 30.08.2017

##### Added

* Added setSneakPeek method

#### [v0.0.17] - 29.08.2017

##### Added

* Added rateChat method
* Added changelog section

#### [v0.0.16] - 24.08.2017

##### Fixed

* Docs fixes - correct method names

#### [v0.0.15] - 24.08.2017

First public Release
